(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[606],{7618:function(e,s,t){Promise.resolve().then(t.bind(t,95))},95:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return h}});var i=t(7437),n=t(2265),a=t(9376),r=t(7648),l=t(2660),d=t(9763);let c=(0,d.Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var o=t(6540);let m=(0,d.Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var x=t(2489),u=t(3053);function h(){let e=(0,a.useRouter)(),[s,t]=(0,n.useState)(!1),[d,h]=(0,n.useState)([]),[p,j]=(0,n.useState)(null),[f,b]=(0,n.useState)(!1),[g,y]=(0,n.useState)(!0),[N,w]=(0,n.useState)(""),[v,I]=(0,n.useState)(!1);(0,n.useEffect)(()=>{localStorage.getItem("adminToken")?(t(!0),k()):e.push("/admin/login")},[e]);let k=async()=>{try{let e="https://foyiurrbytmcwgspbyay.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZveWl1cnJieXRtY3dnc3BieWF5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4NTk1MjgsImV4cCI6MjA4MzQzNTUyOH0.K1HzmpmPM-BU_aprU0xJjYpE5PajGjDEh6PjBM2O2ZM";if(!e||!s){h([{id:"1",user_id:"user_1",customer_email:"jean@example.com",customer_name:"Jean Dupont",total:5e4,status:"pending",shipping_address:"123 Rue de Paris",shipping_city:"Paris",created_at:"2025-01-08T10:00:00Z"},{id:"2",user_id:"user_2",customer_email:"marie@example.com",customer_name:"Marie Martin",total:35e3,status:"verified",shipping_address:"45 Avenue Principale",shipping_city:"Lyon",created_at:"2025-01-07T10:00:00Z"}]),y(!1);return}let t=(0,u.eI)(e,s),{data:i,error:n}=await t.from("orders").select("*").order("created_at",{ascending:!1});if(n)throw n;h(i||[])}catch(e){console.error("Erreur chargement commandes:",e)}finally{y(!1)}},z=async e=>{I(!0);try{if(!d.find(s=>s.id===e))return;let s="https://foyiurrbytmcwgspbyay.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZveWl1cnJieXRtY3dnc3BieWF5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4NTk1MjgsImV4cCI6MjA4MzQzNTUyOH0.K1HzmpmPM-BU_aprU0xJjYpE5PajGjDEh6PjBM2O2ZM";if(s&&t){let i=(0,u.eI)(s,t);await i.from("orders").update({status:"verified"}).eq("id",e)}h(d.map(s=>s.id===e?{...s,status:"verified"}:s)),b(!1),alert("✅ Commande valid\xe9e! Un email de confirmation a \xe9t\xe9 envoy\xe9.")}catch(e){alert("❌ Erreur lors de la validation")}finally{I(!1)}},_=async e=>{if(!N.trim()){alert("Veuillez entrer une raison de rejet");return}I(!0);try{if(!d.find(s=>s.id===e))return;let s="https://foyiurrbytmcwgspbyay.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZveWl1cnJieXRtY3dnc3BieWF5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4NTk1MjgsImV4cCI6MjA4MzQzNTUyOH0.K1HzmpmPM-BU_aprU0xJjYpE5PajGjDEh6PjBM2O2ZM";if(s&&t){let i=(0,u.eI)(s,t);await i.from("orders").update({status:"rejected",rejection_reason:N}).eq("id",e)}h(d.map(s=>s.id===e?{...s,status:"rejected"}:s)),b(!1),w(""),alert("✅ Commande rejet\xe9e. Un email d'explication a \xe9t\xe9 envoy\xe9 au client.")}catch(e){alert("❌ Erreur lors du rejet")}finally{I(!1)}},Z=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"verified":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-wood-100 text-wood-800"}},J=e=>{switch(e){case"pending":return"En attente";case"verified":return"Valid\xe9e";case"rejected":return"Rejet\xe9e";default:return e}};return g||!s?null:(0,i.jsxs)("div",{className:"min-h-screen bg-wood-100",children:[(0,i.jsx)("div",{className:"bg-white border-b border-wood-200 p-6",children:(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[(0,i.jsx)(r.default,{href:"/admin",className:"p-2 hover:bg-wood-100 rounded-lg transition",children:(0,i.jsx)(l.Z,{size:20})}),(0,i.jsxs)("h1",{className:"text-3xl font-bold text-wood-900",children:["Gestion des commandes (",d.length,")"]})]})}),(0,i.jsx)("div",{className:"p-6",children:0===d.length?(0,i.jsx)("div",{className:"text-center py-12",children:(0,i.jsx)("p",{className:"text-wood-600 text-lg",children:"Aucune commande pour le moment"})}):(0,i.jsx)("div",{className:"grid gap-4",children:d.map(e=>(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 hover:shadow-lg transition",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("h3",{className:"font-bold text-wood-900 text-lg",children:["#",e.id]}),(0,i.jsxs)("p",{className:"text-sm text-wood-600",children:[new Date(e.created_at).toLocaleDateString("fr-FR")," - ",e.customer_name||e.customer_email]})]}),(0,i.jsx)("span",{className:"px-4 py-2 rounded-full font-semibold text-sm ".concat(Z(e.status)),children:J(e.status)})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("p",{className:"text-2xl font-bold text-fire-600",children:[e.total.toLocaleString(),"₽"]}),(0,i.jsx)("p",{className:"text-xs text-wood-500 mt-1",children:e.customer_email})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsxs)("button",{onClick:()=>{j(e),b(!0),w("")},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:[(0,i.jsx)(c,{size:18}),"D\xe9tails"]}),"pending"===e.status&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("button",{onClick:()=>z(e.id),disabled:v,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition disabled:opacity-50",children:[v?(0,i.jsx)(o.Z,{size:18,className:"animate-spin"}):(0,i.jsx)(m,{size:18}),"Valider"]}),(0,i.jsxs)("button",{onClick:()=>{j(e),b(!0),w("")},className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",children:[(0,i.jsx)(x.Z,{size:18}),"Rejeter"]})]})]})]})]},e.id))})}),f&&p&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-auto",children:[(0,i.jsxs)("div",{className:"sticky top-0 bg-white border-b border-wood-200 p-6 flex items-center justify-between",children:[(0,i.jsxs)("h2",{className:"text-2xl font-bold text-wood-900",children:["D\xe9tails - Commande #",p.id]}),(0,i.jsx)("button",{onClick:()=>b(!1),className:"text-wood-500 hover:text-wood-700 text-2xl",children:"✕"})]}),(0,i.jsxs)("div",{className:"p-6 space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"font-bold text-wood-900 mb-3",children:"Informations client"}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm bg-wood-50 p-4 rounded-lg",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-wood-600",children:"Nom"}),(0,i.jsx)("p",{className:"font-semibold",children:p.customer_name||"-"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-wood-600",children:"Email"}),(0,i.jsx)("p",{className:"font-semibold text-sm",children:p.customer_email})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-wood-600",children:"Adresse"}),(0,i.jsx)("p",{className:"font-semibold",children:p.shipping_address})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-wood-600",children:"Ville"}),(0,i.jsx)("p",{className:"font-semibold",children:p.shipping_city})]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"font-bold text-wood-900 mb-3",children:"R\xe9capitulatif"}),(0,i.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,i.jsxs)("div",{className:"flex justify-between mb-3",children:[(0,i.jsx)("span",{className:"font-semibold",children:"Montant:"}),(0,i.jsxs)("span",{className:"font-bold text-fire-600 text-lg",children:[p.total.toLocaleString(),"₽"]})]}),(0,i.jsxs)("div",{className:"flex justify-between mb-3",children:[(0,i.jsx)("span",{className:"font-semibold",children:"Statut:"}),(0,i.jsx)("span",{className:"font-bold px-3 py-1 rounded-full text-sm ".concat(Z(p.status)),children:J(p.status)})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"font-semibold",children:"Date:"}),(0,i.jsx)("span",{children:new Date(p.created_at).toLocaleDateString("fr-FR")})]})]})]}),"pending"===p.status&&(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"font-bold text-wood-900 mb-3",children:"En cas de rejet"}),(0,i.jsx)("textarea",{placeholder:"Raison du rejet (obligatoire si rejet)...",value:N,onChange:e=>w(e.target.value),className:"w-full px-4 py-3 border border-wood-200 rounded-lg focus:outline-none focus:border-fire-600 focus:ring-2 focus:ring-fire-100 resize-none",rows:3})]}),(0,i.jsxs)("div",{className:"flex gap-4 pt-4 border-t border-wood-200",children:["pending"===p.status&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("button",{onClick:()=>z(p.id),disabled:v,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:[v?(0,i.jsx)(o.Z,{size:18,className:"animate-spin"}):(0,i.jsx)(m,{size:18}),"Valider"]}),(0,i.jsxs)("button",{onClick:()=>_(p.id),disabled:v||!N.trim(),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:[v?(0,i.jsx)(o.Z,{size:18,className:"animate-spin"}):(0,i.jsx)(x.Z,{size:18}),"Rejeter"]})]}),(0,i.jsx)("button",{onClick:()=>b(!1),disabled:v,className:"flex-1 px-4 py-3 border border-wood-300 rounded-lg hover:bg-wood-50 transition font-semibold disabled:opacity-50",children:"pending"===p.status?"Annuler":"Fermer"})]})]})]})})]})}},2660:function(e,s,t){"use strict";t.d(s,{Z:function(){return i}});let i=(0,t(9763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},6540:function(e,s,t){"use strict";t.d(s,{Z:function(){return i}});let i=(0,t(9763).Z)("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]])},2489:function(e,s,t){"use strict";t.d(s,{Z:function(){return i}});let i=(0,t(9763).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},9376:function(e,s,t){"use strict";var i=t(5475);t.o(i,"usePathname")&&t.d(s,{usePathname:function(){return i.usePathname}}),t.o(i,"useRouter")&&t.d(s,{useRouter:function(){return i.useRouter}})}},function(e){e.O(0,[451,53,971,117,744],function(){return e(e.s=7618)}),_N_E=e.O()}]);