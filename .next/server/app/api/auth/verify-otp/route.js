"use strict";(()=>{var e={};e.id=490,e.ids=[490],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},581:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>g,requestAsyncStorage:()=>c,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>f});var s={};t.r(s),t.d(s,{POST:()=>d});var i=t(9303),o=t(8716),n=t(3131),a=t(7070),u=t(7857);let p={};async function d(e){try{let{email:r,otp:t}=await e.json();if(!r||!t)return a.NextResponse.json({error:"Email et code requis"},{status:400});let s=p[r];if(!s)return a.NextResponse.json({error:"Code invalide ou expir\xe9"},{status:400});if(s.code!==t)return a.NextResponse.json({error:"Code invalide"},{status:400});if(s.expiresAt<Date.now())return delete p[r],a.NextResponse.json({error:"Code expir\xe9"},{status:400});delete p[r];let i="https://yiygigafhnlwzdsbzdsj.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlpeWdpZ2FmaG5sd3pkc2J6ZHNqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3MDYwMjgsImV4cCI6MjA4MzI4MjAyOH0.-f7tLNsGdofpwwtphm0ouRcIj02Ir2RiDzgyvskPs68";if(!i||!o){let e=Buffer.from(JSON.stringify({email:r})).toString("base64");return a.NextResponse.json({success:!0,token:e,userId:r,message:"OTP v\xe9rifi\xe9",needsRegistration:!0})}let n=(0,u.eI)(i,o),{data:d,error:l}=await n.from("profiles").select("id, email, full_name").eq("email",r).single();if(d&&!l){let e=Buffer.from(JSON.stringify({userId:d.id,email:r})).toString("base64");return a.NextResponse.json({success:!0,token:e,userId:d.id,message:"Connexion r\xe9ussie",needsRegistration:!1})}return a.NextResponse.json({success:!0,verified:!0,message:"Code v\xe9rifi\xe9. Compl\xe9tez votre profil",needsRegistration:!0})}catch(e){return console.error("Erreur verify-otp:",e),a.NextResponse.json({error:"Erreur serveur"},{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/verify-otp/route",pathname:"/api/auth/verify-otp",filename:"route",bundlePath:"app/api/auth/verify-otp/route"},resolvedPagePath:"/home/deo/Desktop/bois/app/api/auth/verify-otp/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:f,serverHooks:m}=l,v="/api/auth/verify-otp/route";function g(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:f})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,972,857],()=>t(581));module.exports=s})();